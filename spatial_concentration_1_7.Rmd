---
title: "Spatial Concentration and Diversification in the Dutch Economy - Group 7"
author: 'Group 7: A. Sychevska,  Joshua Azadi Nik Ghaleh'
output:
  html_document:
    toc: true
    toc_depth: 3
    df_print: paged
    number_sections: true
  pdf_document:
    toc: true
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(readxl)
library(ineq)

library(knitr)
library(kableExtra)
library(dplyr)
library(ggplot2)
```

# Introduction

The purpose of this analysis is to examine the **spatial concentration of employment** in the Netherlands across provinces, focusing on two contrasting industries:  

- **A — Agriculture, forestry and fishing**  
- **Q — Health and social work activities**  

The exercise applies regional economics indicators to measure **specialization, concentration, and diversification**, connecting theory to empirical data from **CBS StatLine (2024)**.

The assignment corresponds to the following questions:

- (a) Data preparation and assumptions

- (b) Location quotients (LQ)

- (c) Hirschman–Herfindahl Index (HHI) and Lorenz curves

- (d) Interpretation and theoretical discussion

# (a) Data Preparation and Assumptions

```{r data-prep}
data_raw <- read_csv2("Banen_van_werknemers__SBI2008__regio.csv")
# inspect structure
glimpse(data_raw)

# clean column names
colnames(data_raw) <- c("industry", "region", "period", "employment")

# convert numeric column and trim spaces
data <- data_raw %>%
  mutate(
    region   = str_trim(region),
    industry = str_trim(industry),
    period   = str_trim(period),

    # convert employment correctly
    employment = case_when(
      employment == "." ~ NA_character_,
      TRUE ~ str_replace(employment, ",", ".") 
    ),
    employment = as.numeric(employment)
  ) %>%
  filter(
    region == "Nederland" | str_detect(region, "\\(PV\\)$")
  )
```

```{r}
data_clean <- data %>%
  filter(
    # keep provinces + national
    region == "Nederland" | str_detect(region, "\\(PV\\)$")
  ) %>%
  filter(
    # keep only industries A–S, NOT A-U
    str_detect(industry, "^[A-S] ")
  )

employment_summary <- data_clean%>%
  mutate(ind_code = substr(industry, 1, 1))

employment_wide <- employment_summary %>%
  filter(str_detect(region, "\\(PV\\)$")) %>%
  select(region, ind_code, employment) %>%
  pivot_wider(
    names_from  = ind_code,
    values_from = employment
  ) %>%
  arrange(region)

employment_wide
```


**Assumptions & Issues:**  

The raw CBS StatLine dataset includes employment by industry and region for 2024. During preparation, several issues and assumptions were addressed:

- **Regional filtering:**  
  The dataset contains national totals and non-provincial categories. Only the **12 official provinces** are retained, as required by the assignment, to avoid double counting.

- **Numeric conversion and units:**  
  Employment values are provided as character strings measured in **thousands of jobs**. These are converted to numeric, assuming the scaling is consistent across all sectors and regions.

- **Industry selection:**  
  Only **SBI 1-digit industries** are kept. Missing entries for these industries are treated as zeros when aggregating provincial totals.

- **Use of totals for validation:**  
  National totals (e.g. “Nederland”) are excluded from the analysis but used to **check internal consistency**. Provincial employment sums approximately match national totals, indicating that the cleaned dataset is suitable for concentration and specialization analysis.

- **Final table construction:**  
  After cleaning, employment is aggregated by province and reshaped into a **province × industry** matrix. This table forms the base for calculating LQ, HHI, Lorenz curves, and diversification indicators in the following sections.


# (b) Location Quotients (LQ)

The **Location Quotient (LQ)** indicates the degree of specialization of a province in a particular industry relative to the national average:

$$LQ_{i,j} = \frac{E_{i,j}/E_{i,\text{total}}}{E_{NL,j}/E_{NL,\text{total}}}$$

Values:  
- **LQ > 1:** province is more specialized in that industry than the national average.  
- **LQ < 1:** province is less specialized.

```{r lq}
employment_long <- employment_wide %>%
  pivot_longer(
    cols = -region,
    names_to = "industry",
    values_to = "jobs"
  )

# total employment per province (Ei)
prov_total <- employment_long %>%
  group_by(region) %>%
  summarise(Ei = sum(jobs, na.rm = TRUE), .groups = "drop")

# total employment per industry (Ej)
ind_total <- employment_long %>%
  group_by(industry) %>%
  summarise(Ej = sum(jobs, na.rm = TRUE), .groups = "drop")

# national total employment (E)
E_tot <- sum(employment_long$jobs, na.rm = TRUE)

# compute Location Quotients (LQ)
lq_data <- employment_long %>%
  left_join(prov_total, by = "region") %>%
  left_join(ind_total, by = "industry") %>%
  mutate(
    LQ = (jobs / Ei) / (Ej / E_tot)
  )

lq_data


write_csv(lq_data, "lq_data.csv")
```

```{r}
selected_industries <- c("A", "C", "G", "Q")

lq_selected <- lq_data %>%
  filter(industry %in% selected_industries) %>%
  arrange(industry, region)

lq_selected
```

```{r}
lq_sel <- lq_data %>%
  filter(industry %in% c("A", "C", "G", "Q")) %>%
  select(region, industry, LQ) %>%
  mutate(LQ = round(LQ, 2)) %>%
  arrange(industry, desc(LQ))

lq_table <- lq_sel %>%
  tidyr::pivot_wider(
    names_from = industry,
    values_from = LQ
  )

kable(lq_table, caption = "Location Quotients by Province for Selected Industries (A, C, G, Q)",
      digits = 2) %>%
  kable_styling(full_width = FALSE, position = "center")
```

```{r lq-plot, warning=FALSE, message=FALSE}
ggplot(
  lq_selected,
  aes(x = region, y = LQ, fill = industry)
) +
  geom_col(position = "dodge") +
  geom_hline(yintercept = 1, linetype = "dashed", color = "black") +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Location Quotients (LQ) by Province",
    subtitle = "Industries: A (Agriculture), C (Manufacturing), G (Trade), Q (Health & Social Work)",
    x = "Province",
    y = "LQ Value",
    fill = "Industry"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )
```

### Results

**Agriculture (A)**
- **High specialization:** Zeeland, Flevoland, Limburg  
- **Low specialization:** Utrecht, Groningen, Overijssel  

**Manufacturing (C)**
- **High specialization (LQ > 1):** Noord-Brabant, Gelderland, Overijssel  
- **Low specialization:** Flevoland, Utrecht  

**Trade (G)**
- LQs are **close to 1 in all provinces**, indicating a **highly dispersed and population-driven sector**.

**Health & Social Work (Q)**
- **Higher specialization:** Groningen, Fryslân, Utrecht  
- **Lower specialization:** Limburg, Zeeland  

### Interpretation

The LQ results show strong **regional heterogeneity** in the Dutch economic structure:

- **Agriculture (A)** remains highly concentrated in rural provinces such as **Zeeland, Flevoland, and Limburg**, reflecting land availability and traditional sector patterns.  
- **Manufacturing (C)** clusters in provinces with established industrial bases — especially **Noord-Brabant and Gelderland** — consistent with the presence of supply chains and skilled labor pools.  
- **Trade (G)** is almost evenly distributed across the country, as expected for a sector closely tied to **local consumption and population density**.  
- **Health & Social Work (Q)** shows slightly higher concentration in provinces with major hospitals and university medical centers (**Groningen, Fryslân, Utrecht**).

Overall, the results support the idea that Dutch provinces exhibit **distinct specialization profiles**, confirming substantial **regional economic diversification and concentration patterns**.


# (c) Spatial Concentration — HHI and Lorenz Curves

The **Hirschman–Herfindahl Index (HHI)** measures concentration across provinces:

$$HHI_j = \sum_i s_{ij}^2$$

where \( s_{ij} \) is the share of province *i* in total employment of industry *j*.
```{r group7-data}
# group 7 industries: A and Q

ind_group7 <- c(
  "A Landbouw, bosbouw en visserij",
  "Q Gezondheids- en welzijnszorg"
)

# provinces (PV) and industries A, Q
data_group7 <- employment_summary %>%
  filter(str_detect(region, "\\(PV\\)$"),
         industry %in% ind_group7)

data_group7
```
### HHI

```{r hhi}
province_only <- employment_summary %>%
  filter(str_detect(region, "\\(PV\\)$"))

# compute HHI
hhi_results <- province_only %>%
  group_by(industry) %>%
  mutate(
    share = employment / sum(employment)
  ) %>%
  summarise(
    HHI = sum(share^2),
    .groups = "drop"
  ) %>%
  arrange(desc(HHI))

hhi_results
```
  
### Lorenz Curves

The Lorenz curve visualizes this distribution — the further it lies from the equality line, the more concentrated the industry.

Task: make a Lorenz curve for both industries where you compare the *regional shares of the industry* with the *shares of the provinces in the total national

So:

- x-axis: **cumulative share of provinces in total national employment (all industries)**  
- y-axis: **cumulative share of the industry’s employment**  

Needed:
Employment per province and industry j (A or Q) -> \(E_{ij}\)

```{r lorenz-prep}
# total employment per province (all industries)
prov_totals <- data_clean%>%
  filter(str_detect(region, "\\(PV\\)$")) %>%
  group_by(region) %>%
  summarise(Ei = sum(employment, na.rm = TRUE), .groups = "drop")

E_tot <- sum(prov_totals$Ei, na.rm = TRUE)

prov_shares <- prov_totals %>%
  mutate(prov_share = Ei / E_tot) %>%
  select(region, prov_share)

# join province shares to group 7 industries (A and Q)
lorenz_data <- data_group7 %>%
  left_join(prov_shares, by = "region") %>%
  group_by(industry) %>%
  arrange(prov_share, .by_group = TRUE) %>%
  mutate(
    # industry share per province
    ind_total   = sum(employment, na.rm = TRUE),
    share_ind   = employment / ind_total,
    # Lorenz cumulative shares
    cum_prov    = cumsum(prov_share),
    cum_ind     = cumsum(share_ind)
  ) %>%
  ungroup()

head(lorenz_data, 15)
```

```{r lorenz-plot, fig.height=4.5, fig.width=7}
ggplot(lorenz_data, aes(x = cum_prov, y = cum_ind, color = industry)) +
  geom_line(size = 1.2) +
  geom_abline(slope = 1, intercept = 0, linetype = "dashed") +
  labs(
    title = "Lorenz Curves for Industries A and Q",
    subtitle = "Cumulative provincial share of total employment vs. industry employment",
    x = "Cumulative share of provinces in total employment",
    y = "Cumulative share of industry employment",
    color = "Industry"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0),
    plot.title = element_text(face = "bold")
  )
```

#### Interpretation of Lorenz Curves and HHI

The Lorenz curve and HHI results show clear differences in the spatial distribution of employment across the two industries.

The Hirschman–Herfindahl indices confirm that Agriculture (A) is more spatially concentrated than Health & Social Work (Q). Industry A has an HHI of 0.142, compared to 0.122 for Q, indicating a less even distribution across provinces. Although the numerical difference appears modest, it is economically meaningful: agricultural employment is strongly shaped by land availability and rural specialisation, whereas health-related employment follows population patterns and is therefore more evenly spread.

The Lorenz curves in this case differ from the standard income-style curves.

For Agriculture (A), the curve shows pronounced jumps: several provinces contribute almost nothing to agricultural employment, followed by steep increases where a few provinces dominate. This pattern reflects a highly uneven, specialized spatial structure rather than a smooth deviation from equality.

For Health & Social Work (Q), the curve is smoother and closer to the diagonal, indicating that employment in this sector is more evenly distributed across provinces. The absence of large jumps suggests that all provinces host a substantial share of employment in this industry.

Overall, even though the curves cross the equality line, their shapes reveal that Agriculture is more spatially concentrated, while Health is more evenly spread geographically.

# (d) Indicators the regional specialization of the Dutch economy

The empirical analysis reveals clear and systematic differences in the spatial structure of Dutch employment.  
Using Location Quotients (LQ), Hirschman–Herfindahl Indices (HHI), and Lorenz curves, several patterns emerge.

**1. Regional Specialisation (LQ Results)**

The LQ calculations indicate substantial variation in the extent to which provinces specialise in different economic activities:

- **Agriculture (A)** shows strong specialisation in rural provinces such as **Flevoland, Zeeland, and Limburg**, all of which have LQ values well above 1.  
- Provinces such as **Utrecht, Groningen, and Noord-Holland** have LQs far below 1, confirming that agriculture forms only a small share of their economic base.

In contrast:

- **Health & Social Work (Q)** has LQ values closer to 1 across nearly all provinces.  
- Slightly higher specialisation occurs in **Groningen, Fryslân, and Utrecht**, while **Limburg and Zeeland** lie below the national average.

These results highlight that industry composition differs strongly across space: agriculture is highly geographically specialised, whereas health and social services are dispersed and tied to population density.

**2. Spatial Concentration (HHI Results)**

The Hirschman–Herfindahl Index provides a complementary quantitative measure:

- **Agriculture (A)** has a higher HHI (~0.142), indicating **greater spatial concentration**.
- **Health & Social Work (Q)** has a lower HHI (~0.122), consistent with a **more even spatial distribution**.

Although the numerical difference seems modest, it is economically meaningful: agricultural employment is concentrated in only a few provinces, whereas health employment is present everywhere.


**3. Lorenz Curves**

The Lorenz curves further illustrate these differences:

- The curve for **Agriculture** displays **large jumps**: several provinces contribute almost nothing to agricultural employment, followed by steep increases from a few dominant provinces.  
  This is characteristic of a **highly uneven and specialised spatial pattern**.

- The curve for **Health & Social Work** lies much closer to the diagonal, indicating a **smoother and more evenly distributed** pattern across provinces.

Together, the LQ, HHI, and Lorenz curve results paint a consistent picture:

- **Agriculture is spatially concentrated**, dependent on land availability and rural characteristics.
- **Health & Social Work is spatially diversified**, reflecting widespread demand and demographic determinants.
- Provincial economies in the Netherlands display **substantial structural heterogeneity**, with different regions specializing in different types of economic activity.
- Indicators reinforce each other: high LQ provinces for Agriculture are the same provinces driving its high HHI and steep Lorenz curve.

# Appendix A: Data Sources and Preparation

**Data source**

The employment dataset is obtained from **CBS StatLine**:

- **Table:** *Banen van werknemers in december; economische activiteit (SBI2008), regio*  
- **Year selected:** 2024  
- **Sector level:** *Bedrijfstakken 1e digit* (A–S)  
- **Regional unit:** Provinces (*Provincies*) + national totals  
- **Period:** `"2024 december*"`

**Import and cleaning**

The original file was downloaded as a CSV and imported into R.

Data preparation steps:

- Renamed variables to: `industry`, `region`, `period`, `employment`.
- Converted `employment` from character to numeric, replacing comma decimals with dots.
- Interpreted employment values as **jobs (x 1,000)**, as defined by CBS.
- Filtered the dataset to retain only observations for `"2024 december*"`.

**Selection for Group 7**

The assignment for Group 7 focuses on:

- **A — Agriculture, forestry and fishing**  
- **Q — Health and social work activities**

Steps applied:

- Filtered rows where `industry` begins with `"A "` or `"Q "` using `str_detect()`.
- Constructed a **province × industry** table using `pivot_wider()`.

**Treatment of totals**
- National totals and “not allocated” categories (e.g. `"Nederland"`) are **kept temporarily** to check data consistency.
- These totals were used only to verify that the sum of provincial employment approximates the national number.
- They are **excluded** from all concentration, LQ, Lorenz, and HHI calculations.
